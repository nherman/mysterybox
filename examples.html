<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css">
        <style type="text/css">
            html {
                height:100%;
            }
            body {
                height:100%;
                margin:0;
                background-color: #eee;
            }
        </style>

        <script src="mysterybox.js"></script>
        <script src="mb_plugins.js"></script>
        <script>
var insertpoint = "<!-- tests -->",
    endpoint = "<!-- /tests -->",
    defaultHTML = "",
    defaultCSS = "",
    tests = {
    "Multi-line": function() {
        var mb = new window.MYSTERYBOX();
        mb.initMsg("t\n.#.\n.###.\n.#%##%.\n.%##%###.\n.##%###%##.\n.#%###%##%##.\n#\n#\n");
//        mb.initRandom();
        mb.renderMsg();
        mb.resolve({
            "callback": function() {
//                 resetTests();
            }
        });
    },
    "Basic": function() {
        var mb = new window.MYSTERYBOX({
            "message": "Some are sad and some are glad and some are very, very bad. Why are they sad and glad and bad? I do not know. Go ask your dad."
        });
        mb.initRandom();
        mb.resolve({
            "callbackDelayMilliseconds": 2000,
            "callback": function() {
                mb.dissolve({
                    "callbackDelayMilliseconds": 1000,
                    "callback": function() {
                         mb.renderMsg();
                         resetTests();
                    }
                });
            }
        });
    },
    "Falling Rain": function() {
        var mb = new window.MYSTERYBOX({
            "message": "Why are they sad and glad and bad? I do not know. Go ask your dad."
        });
        mb.initRandom();
        mb.resolveByColumn({
            "threads": 5,
            "intervalMilliseconds": 50,
            "callbackDelayMilliseconds": 2000,
            "callback": function() {
                mb.dissolve({
                    "callback": function() {
                        resetTests();
                    }
                });
            }
        });
    }
};

function startTest(testName) {
    tests[testName]();
    return false;
}

function resetTests(m) {
    m = m || 2000;
    setTimeout(writeTests,m);
}

function writeTests() {
    var body = document.getElementsByTagName("body")[0],
        html = body.innerHTML,
        cursor = "",
        insert = function(text,offset) {
            offset = offset || 0;
            html = html.substring(0,cursor) + text + html.substring(cursor+offset);
        },
        template = '<a href="#" class="list-group-item" data-test="%1" onclick="startTest(\'%1\');">%1<pre>    %2</pre></a>';

    /* store markup on load. otherwise, reset markup */
    if (defaultHTML == "") {
        defaultHTML = html;
        defaultCSS = body.style.cssText;
    } else {
        html = defaultHTML;
        body.style.cssText = defaultCSS;
    }

    /* find insertion point */
    cursor = html.indexOf(insertpoint)+insertpoint.length;

    /* write list of tests */
    for (test in tests){
        if (tests.hasOwnProperty(test)) {
            insert(template.replace(/%1/g,test).replace(/%2/,tests[test].toString()));
        }
    }

    /* update DOM */
    body.innerHTML = html;
}

window.onload = function() {
    writeTests();
}

        </script>
    <body>
        <div class="container">
            <h1>mysterybox examples</h1>
            <div class="list-group">
            <!-- tests -->
            <!-- /tests -->
            </div>
        </div>
    </body>
</html>